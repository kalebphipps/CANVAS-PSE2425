{% load static %}
{% block style %}
    <link href="{% static 'css/settings.css' %}" rel="stylesheet" type="text/css" />
{% endblock style %}
{% block body %}
<div
    class="modal fade"
    id="settings"
    tabindex="-1"
    aria-labelledby="exampleModalLabel"
    aria-hidden="true"
>
    <div class="modal-dialog modal-xl modal-dialog-centered" style="height:80vh;">
        <div class="modal-content rounded-4 h-100 overflow-auto">
            <div class="modal-header">
                <h5 class="modal-title">Settings</h5>
                <button
                    type="button"
                    class="btn-close"
                    data-bs-dismiss="modal"
                    aria-label="Close"
                ></button>
            </div>
            <div class="modal-body gap-2 d-flex flex-column h-100">
                <div class="d-flex flex-fill">
                    <div
                        class="nav flex-column nav-pills me-3 sticky-top"
                        id="v-pills-tab"
                        role="tablist"
                        aria-orientation="vertical"
                    >
                        <button
                            class="nav-link active"
                            id="v-pills-general-tab"
                            data-bs-toggle="pill"
                            data-bs-target="#v-pills-general"
                            type="button"
                            role="tab"
                            aria-controls="v-pills-profile"
                            aria-selected="false"
                        >
                            <div class="d-flex gap-2">
                                <i class="bi bi-gear"></i>
                                <p class="m-0">General</p>
                            </div>
                        </button>
                        <button
                            class="nav-link"
                            id="v-pills-profil-tab"
                            data-bs-toggle="pill"
                            data-bs-target="#v-pills-profil"
                            type="button"
                            role="tab"
                            aria-controls="v-pills-profil"
                            aria-selected="true"
                        >
                            <div class="d-flex gap-2">
                                <i class="bi bi-person"></i>
                                <p class="m-0">Account</p>
                            </div>
                        </button>
                        <button
                            class="nav-link"
                            id="v-pills-appearance-tab"
                            data-bs-toggle="pill"
                            data-bs-target="#v-pills-appearance"
                            type="button"
                            role="tab"
                            aria-controls="v-pills-appearance"
                            aria-selected="true"
                        >
                            <div class="d-flex gap-2">
                                <i class="bi bi-palette"></i>
                                <p class="m-0">Appearance</p>
                            </div>
                        </button>
                    </div>
                    <div
                        class="tab-content d-flex border-start ps-3 flex-fill"
                        id="v-pills-tabContent"
                    >
                        <div
                            class="tab-pane fade show active w-100"
                            id="v-pills-general"
                            role="tabpanel"
                            aria-labelledby="v-pills-general-tab"
                            tabindex="0"
                        >
                            <form class="d-flex flex-column h-100">
                                <div class="flex-grow-1"></div>
                                <div class="d-flex justify-content-end">
                                    <button
                                        type="submit"
                                        class="btn btn-primary"
                                    >
                                        Save
                                    </button>
                                </div>
                            </form>
                        </div>
                        <div
                            class="tab-pane fade w-100"
                            id="v-pills-profil"
                            role="tabpanel"
                            aria-labelledby="v-pills-profil-tab"
                            tabindex="0"
                        >
                            <form
                                class="d-flex flex-column h-100"
                                method="POST"
                                action="{% url 'update_account' %}"
                            >
                                {% csrf_token %}
                                <div class="flex-grow-1 overflow-auto">
                                    <h5 class="fw-bold">Account Details</h5>
                                    <div class="mb-3 d-flex">
                                        <div class="me-2 w-50">
                                            <label
                                                for="first_name"
                                                class="form-label"
                                            >First Name</label>
                                            <input
                                                type="text"
                                                class="form-control"
                                                id="first_name"
                                                name="first_name"
                                                value="{{ user.first_name }}"
                                            />
                                        </div>
                                        <div class="w-50">
                                            <label
                                                for="last_name"
                                                class="form-label"
                                            >Last Name</label>
                                            <input
                                                type="text"
                                                class="form-control"
                                                id="last_name"
                                                name="last_name"
                                                value="{{ user.last_name }}"
                                            />
                                        </div>
                                    </div>
                                    <div class="mb-3">
                                        <label for="email" class="form-label"
                                            >Email</label
                                        >
                                        <input
                                            type="email"
                                            class="form-control"
                                            id="email"
                                            name="email"
                                            value="{{ user.email }}"
                                        />
                                    </div>
                                    <hr />
                                    <h5 class="fw-bold">Change Password</h5>
                                    <div class="mb-3">
                                        <label
                                            for="old_password"
                                            class="form-label"
                                            >Old Password</label
                                        >
                                        <input
                                            type="password"
                                            class="form-control"
                                            id="old_password"
                                            name="old_password"
                                        />
                                    </div>
                                    <div class="mb-3">
                                        <label
                                            for="new_password"
                                            class="form-label"
                                            >New Password</label
                                        >
                                        <input
                                            type="password"
                                            class="form-control"
                                            id="new_password"
                                            name="new_password"
                                        />
                                    </div>
                                    <div class="mb-3">
                                        <label
                                            for="password_confirmation"
                                            class="form-label"
                                            >Confirm New Password</label
                                        >
                                        <input
                                            type="password"
                                            class="form-control"
                                            id="password_confirmation"
                                            name="password_confirmation"
                                        />
                                    </div>
                                </div>
                                <div class="d-flex justify-content-between mt-3">
                                    <button
                                        type="submit"
                                        class="btn btn-primary"
                                    >
                                        Save
                                    </button>
                            
                                    <!-- Button to trigger Delete Account Modal -->
                                    <button
                                        type="button"
                                        class="btn btn-danger"
                                        data-bs-toggle="modal"
                                        data-bs-target="#deleteAccountModal"
                                    >
                                        Delete Account
                                    </button>
                                </div>
                            </form>
                        </div>
                        <div
                            class="tab-pane fade w-100"
                            id="v-pills-appearance"
                            role="tabpanel"
                            aria-labelledby="v-pills-appearance-tab"
                            tabindex="0"
                        >
                            <div class="d-flex align-items-center gap-2">
                                <div>Theme:</div>
                                <button
                                    class="btn btn-secondary"
                                    id="mode-toggle"
                                ></button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Delete Account Confirmation Modal -->
<div class="modal fade" id="deleteAccountModal" tabindex="-1" aria-labelledby="deleteAccountModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="deleteAccountModalLabel">Confirm Account Deletion</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>Are you sure you want to delete your account? Please enter your password to confirm.</p>
                <form method="POST" action="/delete_account/">
                    {% csrf_token %}
                    <div class="mb-3">
                        <label for="confirm_password" class="form-label">Password</label>
                        <input type="password" class="form-control" id="confirm_password" name="password" required>
                    </div>
                    <div class="d-flex justify-content-end">
                        <button type="button" class="btn btn-secondary me-2" data-bs-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-danger">Delete Account</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>


<!-- Error/Success Messages Modal -->
<div class="modal fade" id="messageModal" tabindex="-1" aria-labelledby="messageModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="messageModalLabel">Messages</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <ul id="message-list"></ul>
            </div>
        </div>
    </div>
</div>

{% if messages %}
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            var messageList = document.getElementById('message-list');
            var messageModal = new bootstrap.Modal(document.getElementById('messageModal'));

            {% for message in messages %}
                var listItem = document.createElement('li');
                listItem.textContent = "{{ message|escapejs }}";

                {% if message.tags == "success" %}
                    listItem.style.color = "green";
                {% elif message.tags == "error" %}
                    listItem.style.color = "red";
                {% else %}
                    listItem.style.color = "black";
                {% endif %}

                messageList.appendChild(listItem);
            {% endfor %}

            if (messageList.children.length > 0) {
                messageModal.show();
            }
        });
    </script>
{% endif %}

{% endblock body %}

<!-- Script to handle custom behavior for Ctrl + S -->
<script>
    document.addEventListener('keydown', function (event) {
        // Check if Ctrl + S is pressed
        if (event.ctrlKey && event.key === 's') {
            event.preventDefault(); // Prevent default browser "save" action

            // Check if we are on the Account settings tab
            const accountTab = document.getElementById('v-pills-profil');
            if (accountTab && accountTab.classList.contains('show')) {
                const form = document.querySelector('form[action="{% url "update_account" %}"]');
                if (form) {
                    form.submit();  // Submit the form
                }
            }
        }
    });
</script>